---
# Keycloak HA Multi-Host Inventory
# 
# This inventory defines 2 physical hosts for distributed Keycloak HA deployment:
# - multiregion-1: 10.11.5.71 (user: fhaas)
# - multiregion-2: 10.5.4.161 (user: tdx)

all:
  children:
    # etcd distributed consensus cluster (both nodes)
    etcd_cluster:
      hosts:
        multiregion-1:
          etcd_name: etcd-nodo1
          etcd_client_port: 2379
          etcd_peer_port: 2380
        multiregion-2:
          etcd_name: etcd-nodo2
          etcd_client_port: 2379
          etcd_peer_port: 2380
    
    # PostgreSQL + Patroni HA cluster
    postgres_cluster:
      hosts:
        multiregion-1:
          postgres_name: postgres-nodo1
          patroni_name: postgres-nodo1
          postgres_port: 5432
          patroni_api_port: 8008
          is_primary_node: true   # Bootstrap as PRIMARY
        multiregion-2:
          postgres_name: postgres-nodo2
          patroni_name: postgres-nodo2
          postgres_port: 5432
          patroni_api_port: 8008
          is_primary_node: false  # Join as REPLICA
    
    # HAProxy load balancers (query routers)
    haproxy_nodes:
      hosts:
        multiregion-1:
          haproxy_name: haproxy-nodo1
          haproxy_postgres_port: 15432  # Different from PostgreSQL's 5432 to avoid conflict
          haproxy_replica_port: 15433
          haproxy_stats_port: 7000
        multiregion-2:
          haproxy_name: haproxy-nodo2
          haproxy_postgres_port: 15432  # Different from PostgreSQL's 5432 to avoid conflict
          haproxy_replica_port: 15433
          haproxy_stats_port: 7000
    
    # Keycloak application servers (Active-Active)
    keycloak_nodes:
      hosts:
        multiregion-1:
          keycloak_name: keycloak-nodo1
          keycloak_https_port: 8443
          keycloak_jgroups_port: 7800
        multiregion-2:
          keycloak_name: keycloak-nodo2
          keycloak_https_port: 8443
          keycloak_jgroups_port: 7800
  
  # Host-specific connection details
  hosts:
    multiregion-1:
      ansible_host: 10.11.5.71      # Management/SSH IP
      internal_ip: 10.1.0.1          # Private network IP (for inter-service communication)
      ansible_user: fhaas
      ansible_python_interpreter: /usr/bin/python3
      node_name: nodo1
      node_number: 1

    multiregion-2:
      ansible_host: 10.5.4.161      # Management/SSH IP
      internal_ip: 10.1.0.2          # Private network IP (for inter-service communication)
      ansible_user: tdx
      ansible_python_interpreter: /usr/bin/python3
      node_name: nodo2
      node_number: 2
